<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flashcard Study Tool</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    .card-container {
      perspective: 1000px;
    }
    
    .flashcard {
      transition: transform 0.3s ease, opacity 0.3s ease;
      transform-style: preserve-3d;
    }
    
    .flashcard.flipped {
      transform: rotateY(180deg);
    }
    
    .card-front, .card-back {
      backface-visibility: hidden;
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      border-radius: 1rem;
    }
    
    .card-back {
      transform: rotateY(180deg);
    }
    
    .swipe-left {
      animation: swipeLeft 0.4s ease-out forwards;
    }
    
    .swipe-right {
      animation: swipeRight 0.4s ease-out forwards;
    }
    
    @keyframes swipeLeft {
      to {
        transform: translateX(-150%) rotate(-20deg);
        opacity: 0;
      }
    }
    
    @keyframes swipeRight {
      to {
        transform: translateX(150%) rotate(20deg);
        opacity: 0;
      }
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .spinner {
      animation: spin 1s linear infinite;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="h-full w-full overflow-auto"></div>
  <script>
    let CARD_SETS = [];

    const defaultConfig = {
      app_title: 'Flashcard Study Tool',
      instructions_text: 'Select your study sets and start practicing',
      background_color: '#f0f4f8',
      surface_color: '#ffffff',
      text_color: '#1a202c',
      primary_action_color: '#3b82f6',
      secondary_action_color: '#64748b',
      font_family: 'system-ui',
      font_size: 16
    };

    let config = defaultConfig;

    let appState = {
      screen: 'loading',
      selectedSets: [],
      currentDeck: [],
      currentIndex: 0,
      isFlipped: false,
      results: [],
      error: null
    };

    async function loadCardSets() {
      try {
        // Load the index file that lists all available card sets
        const indexResponse = await fetch('https://raw.githubusercontent.com/EngineeringShare/engineering-hub/refs/heads/main/interactive/card-sets/index.json');
        if (!indexResponse.ok) {
          throw new Error('Could not load card sets index. Make sure card-sets/index.json exists.');
        }
        const fileList = await indexResponse.json();
        
        // Load all card set files
        const loadPromises = fileList.map(async (filename) => {
          const response = await fetch(`./card-sets/${filename}`);
          if (!response.ok) {
            throw new Error(`Could not load ${filename}`);
          }
          return await response.json();
        });
        
        CARD_SETS = await Promise.all(loadPromises);
        appState.screen = 'menu';
        appState.error = null;
      } catch (error) {
        console.error('Error loading card sets:', error);
        appState.error = error.message;
        appState.screen = 'error';
      }
      render();
    }

    function init() {
      render();
      loadCardSets();
    }

    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    function toggleSetSelection(setId) {
      const index = appState.selectedSets.indexOf(setId);
      if (index > -1) {
        appState.selectedSets.splice(index, 1);
      } else {
        appState.selectedSets.push(setId);
      }
      render();
    }

    function startStudying() {
      if (appState.selectedSets.length === 0) return;
      
      const allCards = [];
      CARD_SETS.forEach(set => {
        if (appState.selectedSets.includes(set.id)) {
          allCards.push(...set.cards);
        }
      });
      
      appState.currentDeck = shuffleArray(allCards);
      appState.currentIndex = 0;
      appState.isFlipped = false;
      appState.results = [];
      appState.screen = 'study';
      render();
    }

    function flipCard() {
      appState.isFlipped = !appState.isFlipped;
      render();
    }

    async function handleAnswer(correct) {
      const card = appState.currentDeck[appState.currentIndex];
      appState.results.push({ cardId: card.id, correct, tags: card.tags });
      
      const cardElement = document.querySelector('.flashcard');
      if (cardElement) {
        cardElement.classList.add(correct ? 'swipe-right' : 'swipe-left');
        
        await new Promise(resolve => setTimeout(resolve, 400));
      }
      
      if (appState.currentIndex < appState.currentDeck.length - 1) {
        appState.currentIndex++;
        appState.isFlipped = false;
        render();
      } else {
        appState.screen = 'results';
        render();
      }
    }

    function calculateTagStats() {
      const tagStats = {};
      
      appState.results.forEach(result => {
        result.tags.forEach(tag => {
          if (!tagStats[tag]) {
            tagStats[tag] = { correct: 0, total: 0 };
          }
          tagStats[tag].total++;
          if (result.correct) {
            tagStats[tag].correct++;
          }
        });
      });
      
      return Object.entries(tagStats)
        .map(([tag, stats]) => ({
          tag,
          percentage: Math.round((stats.correct / stats.total) * 100),
          correct: stats.correct,
          total: stats.total
        }))
        .sort((a, b) => a.percentage - b.percentage);
    }

    function returnToMenu() {
      appState.screen = 'menu';
      appState.selectedSets = [];
      render();
    }

    function retryLoading() {
      appState.screen = 'loading';
      appState.error = null;
      render();
      loadCardSets();
    }

    function render() {
      const app = document.getElementById('app');
      
      const bgColor = config.background_color;
      const surfaceColor = config.surface_color;
      const textColor = config.text_color;
      const primaryColor = config.primary_action_color;
      const secondaryColor = config.secondary_action_color;
      
      if (appState.screen === 'loading') {
        app.innerHTML = `
          <div class="h-full w-full flex items-center justify-center" style="background-color: ${bgColor}; color: ${textColor};">
            <div class="text-center">
              <div class="spinner w-16 h-16 border-4 rounded-full mx-auto mb-4" style="border-color: ${primaryColor}; border-top-color: transparent;"></div>
              <p class="text-xl font-semibold">Loading card sets...</p>
            </div>
          </div>
        `;
      } else if (appState.screen === 'error') {
        app.innerHTML = `
          <div class="h-full w-full flex items-center justify-center p-8" style="background-color: ${bgColor}; color: ${textColor};">
            <div class="max-w-md text-center">
              <div class="text-6xl mb-4">⚠️</div>
              <h1 class="text-2xl font-bold mb-4">Error Loading Card Sets</h1>
              <p class="mb-6 opacity-75">${appState.error}</p>
              <div class="p-4 rounded-lg mb-6 text-left text-sm" style="background-color: ${surfaceColor};">
                <p class="font-semibold mb-2">Make sure you have:</p>
                <ul class="list-disc list-inside space-y-1 opacity-75">
                  <li>A <code>card-sets/</code> folder in the same directory as this HTML file</li>
                  <li>An <code>index.json</code> file inside that folder</li>
                  <li>Your card set JSON files listed in the index</li>
                </ul>
              </div>
              <button onclick="retryLoading()" class="py-3 px-6 rounded-lg font-semibold" style="background-color: ${primaryColor}; color: white;">
                Try Again
              </button>
            </div>
          </div>
        `;
      } else if (appState.screen === 'menu') {
        app.innerHTML = `
          <div class="min-h-full w-full p-8" style="background-color: ${bgColor}; color: ${textColor};">
            <div class="max-w-4xl mx-auto">
              <h1 class="text-4xl font-bold mb-2 text-center">${config.app_title}</h1>
              <p class="text-center mb-8 opacity-75">${config.instructions_text}</p>
              
              ${CARD_SETS.length === 0 ? `
                <div class="text-center p-8" style="background-color: ${surfaceColor}; border-radius: 1rem;">
                  <p class="text-xl opacity-75">No card sets available. Add some JSON files to the card-sets folder!</p>
                </div>
              ` : `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
                  ${CARD_SETS.map(set => `
                    <label class="flex items-center p-4 rounded-lg cursor-pointer transition-all hover:shadow-md" style="background-color: ${surfaceColor}; border: 2px solid ${appState.selectedSets.includes(set.id) ? primaryColor : 'transparent'};">
                      <input type="checkbox" class="w-5 h-5 mr-4" ${appState.selectedSets.includes(set.id) ? 'checked' : ''} onchange="toggleSetSelection('${set.id}')" style="accent-color: ${primaryColor};">
                      <div class="flex-1">
                        <h3 class="font-semibold mb-1">${set.name}</h3>
                        <p class="text-sm opacity-75">${set.cards.length} cards</p>
                      </div>
                    </label>
                  `).join('')}
                </div>
                
                <button 
                  onclick="startStudying()" 
                  ${appState.selectedSets.length === 0 ? 'disabled' : ''}
                  class="w-full py-4 px-6 rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                  style="background-color: ${primaryColor}; color: white;">
                  Start Studying (${appState.selectedSets.reduce((total, setId) => {
                    const set = CARD_SETS.find(s => s.id === setId);
                    return total + (set ? set.cards.length : 0);
                  }, 0)} cards)
                </button>
              `}
            </div>
          </div>
        `;
      } else if (appState.screen === 'study') {
        const card = appState.currentDeck[appState.currentIndex];
        
        app.innerHTML = `
          <div class="h-full w-full flex flex-col" style="background-color: ${bgColor}; color: ${textColor};">
            <div class="p-4" style="background-color: ${surfaceColor}; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
              <div class="max-w-4xl mx-auto flex justify-between items-center">
                <span class="font-semibold">Card ${appState.currentIndex + 1} of ${appState.currentDeck.length}</span>
                <button onclick="returnToMenu()" class="px-4 py-2 rounded-lg transition-all" style="background-color: ${secondaryColor}; color: white;">Exit</button>
              </div>
            </div>
            
            <div class="flex-1 flex items-center justify-center p-8">
              <div class="card-container w-full max-w-2xl" style="height: 400px;">
                <div class="flashcard relative w-full h-full ${appState.isFlipped ? 'flipped' : ''}" onclick="flipCard()">
                  <div class="card-front" style="background: linear-gradient(135deg, ${primaryColor}, ${primaryColor}dd); color: white; cursor: pointer;">
                    <div class="text-center w-full">
                      <p class="text-sm opacity-75 mb-4">QUESTION</p>
                      ${card.questionImage ? `<img src="${card.questionImage}" alt="Question image" class="max-w-full max-h-48 mx-auto mb-4 rounded-lg" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';" style="object-fit: contain;"><p style="display:none;" class="text-sm opacity-75 mb-4">Image failed to load</p>` : ''}
                      <h2 class="font-bold">${card.question}</h2>
                      <p class="text-sm opacity-75 mt-6">Click to reveal answer</p>
                    </div>
                  </div>
                  <div class="card-back" style="background-color: ${surfaceColor}; border: 3px solid ${primaryColor}; cursor: pointer;">
                    <div class="text-center w-full">
                      <p class="text-sm opacity-75 mb-4">ANSWER</p>
                      ${card.answerImage ? `<img src="${card.answerImage}" alt="Answer image" class="max-w-full max-h-48 mx-auto mb-4 rounded-lg" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';" style="object-fit: contain;"><p style="display:none;" class="text-sm opacity-75 mb-4">Image failed to load</p>` : ''}
                      <h2 class="font-bold" style="color: ${primaryColor};">${card.answer}</h2>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="p-8" style="background-color: ${surfaceColor};">
              <div class="max-w-2xl mx-auto">
                <div class="flex gap-4 mb-4">
                  <button 
                    onclick="handleAnswer(false)" 
                    ${!appState.isFlipped ? 'disabled' : ''}
                    class="flex-1 py-4 px-6 rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                    style="background-color: #ef4444; color: white;">
                    ✗ Wrong
                  </button>
                  <button 
                    onclick="handleAnswer(true)" 
                    ${!appState.isFlipped ? 'disabled' : ''}
                    class="flex-1 py-4 px-6 rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                    style="background-color: #10b981; color: white;">
                    ✓ Correct
                  </button>
                </div>
                <div class="flex flex-wrap gap-2 justify-center">
                  ${card.tags.map(tag => `
                    <span class="px-3 py-1 rounded-full text-sm" style="background-color: ${bgColor}; color: ${textColor};">${tag}</span>
                  `).join('')}
                </div>
              </div>
            </div>
          </div>
        `;
      } else if (appState.screen === 'results') {
        const tagStats = calculateTagStats();
        const correctCount = appState.results.filter(r => r.correct).length;
        const totalCount = appState.results.length;
        const percentage = Math.round((correctCount / totalCount) * 100);
        
        app.innerHTML = `
          <div class="min-h-full w-full p-8" style="background-color: ${bgColor}; color: ${textColor};">
            <div class="max-w-4xl mx-auto">
              <h1 class="font-bold mb-8 text-center">Study Session Complete!</h1>
              
              <div class="p-8 rounded-xl mb-8 text-center" style="background-color: ${surfaceColor};">
                <div class="text-6xl font-bold mb-2" style="color: ${primaryColor};">${percentage}%</div>
                <p class="text-xl opacity-75">${correctCount} out of ${totalCount} correct</p>
              </div>
              
              <div class="p-6 rounded-xl mb-8" style="background-color: ${surfaceColor};">
                <h2 class="font-semibold mb-4">Focus Areas</h2>
                <p class="text-sm opacity-75 mb-4">Topics where you need more practice:</p>
                <div class="space-y-3">
                  ${tagStats.slice(0, 5).map(stat => `
                    <div>
                      <div class="flex justify-between mb-1">
                        <span class="font-medium">${stat.tag}</span>
                        <span class="opacity-75">${stat.correct}/${stat.total} (${stat.percentage}%)</span>
                      </div>
                      <div class="w-full rounded-full h-2" style="background-color: ${bgColor};">
                        <div class="h-2 rounded-full transition-all" style="width: ${stat.percentage}%; background-color: ${stat.percentage >= 70 ? '#10b981' : stat.percentage >= 40 ? '#f59e0b' : '#ef4444'};"></div>
                      </div>
                    </div>
                  `).join('')}
                </div>
              </div>
              
              <button onclick="returnToMenu()" class="w-full py-4 px-6 rounded-lg font-semibold transition-all" style="background-color: ${primaryColor}; color: white;">
                Study Again
              </button>
            </div>
          </div>
        `;
      }
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b9a4524249ad519',t:'MTc2NzY5MjU5Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>